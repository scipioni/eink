# https://taskfile.dev

version: '3'

vars:
  GREETING: Hello, World!

env:
  CONFIG: eink

dotenv: ['.env']

tasks:
  default:
    cmds:
      - echo "{{.GREETING}}"
    silent: true
  setup:
    cmds:
      - docker pull ghcr.io/esphome/esphome

  flash:serial:
    cmds:
      - docker compose run --rm esphome run $CONFIG.yaml --device /dev/ttyACM0
  
  flash:
    cmds:
      - docker compose run --rm esphome run $CONFIG.yaml --device eink.local
  
  compile:
    cmds:
      - docker compose run --rm esphome compile $CONFIG.yaml

  run:
    cmds:
      - task: compile
      - task: flash:serial
  
  logs:
    cmds:
      - docker compose run --rm esphome logs $CONFIG.yaml --device eink.local

  logs:serial:
    cmds:
      - docker compose run --rm esphome logs $CONFIG.yaml --device /dev/ttyACM0
